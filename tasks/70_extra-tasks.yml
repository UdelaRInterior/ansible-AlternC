---
## Additional tasks not directly related to AlternC

- block: 
  - name: Make MySQL server listen on public IP
    lineinfile:
      path: /etc/mysql/mariadb.conf.d/50-server.cnf
      line: '# bind-address          = 127.0.0.1'
      regexp: 'bind-address\s*=\s*127\.0\.0\.1'
      backup: yes
    when: alternc_open_mysql
    notify: AlternC - restart mysql

  - name: Verify if the pymysql module is installed
    apt:
      name: python-pymysql
      state: present
    when: alternc_extra_mysql_users | length > 0

  - debug:
      var: alternc_mysql_user
      verbosity: 2
    loop: "{{ alternc_extra_mysql_users }}"
    loop_control:
      loop_var: alternc_mysql_user

  - name: Create extra mysql users
    mysql_user:
      name: "{{ alternc_mysql_user.name }}"
      host: "{{ alternc_mysql_user.host }}"
      password: "{{ alternc_mysql_user.password }}"
      priv: "{{ alternc_mysql_user.priv }}"
      login_unix_socket: /run/mysqld/mysqld.sock
      # login_user: root
      # login_password: "{{ root_pass_mysql }}"
      state: "{{ item.state | default ('present') }}"
    loop: "{{ alternc_extra_mysql_users }}"
    loop_control:
      loop_var: alternc_mysql_user
  tags: alternc:dbuser

...
